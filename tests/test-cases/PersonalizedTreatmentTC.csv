TestID,Name,Description,Prerequisites,Expected Output,Actual Output,Status
PT-001,Admin Create Diagnosis,Admin creates a new diagnosis type with name and description,Admin logged into Admin Dashboard; unique diagnosis name provided,Diagnosis created; appears in diagnosis list; 201 Created; no duplicate error,test_PT001: Admin successfully created new diagnosis,pass
PT-002,Admin Create Duplicate Diagnosis,Admin attempts to create diagnosis with existing name,Admin logged in; name already exists,Request rejected with 400 or 409; clear error message "Diagnosis already exists",,
PT-003,Admin Create Treatment Template,Admin adds a template under a diagnosis with steps and metadata,Admin logged in; diagnosis exists; template payload valid,Template saved; visible under diagnosis; templateId returned; 201 Created,test_PT003: Admin successfully created new treatment template,pass
PT-004,Admin Validation Missing Fields,Admin submits template creation with missing required fields,Admin logged in; template payload missing title or steps,Request rejected with 400; validation errors returned,,
PT-005,Admin Add Multiple Templates,Admin adds an ordered multiple steps to a template,Admin logged in; template exists; step payload valid,Step inserted with correct order; appears in template step list,test_PT005: Admin successfully added multiple steps to template,pass
PT-006,Admin Add Workflow Steps,Admin adds multiple steps to a template workflow,Admin logged in; template exists; multiple step payloads valid,Step order updated in DB; UI reflects new order; no gaps or duplicates in ordering,test_PT006: Admin successfully added multiple workflow steps,pass
PT-007,Admin Edit Template Step,Admin updates step fields title appointment_type suggested_time_gap,Admin logged in; step exists; valid patch,Step updated; changes visible in template; audit log entry created,,
PT-008,Admin Delete Template,Admin creates a diagnosis and template; then deletes the template and verifies the count decreases,Admin logged in; step exists and not linked to active patient plans,Step removed; DB integrity maintained; if linked to active plans either prevented or flagged per policy,,
PT-009,Admin Delete Template With Active Plans,Admin attempts to delete template that has active patient plans,Admin logged in; template linked to active plans,Operation blocked; clear error message; admin prompted to archive instead,,
PT-010,Doctor Search Diagnosis,Doctor searches diagnoses by keyword and sees matching templates,Doctor logged in; diagnoses exist,Search returns matching diagnoses and templates; results paginated; relevance correct,test_PT010: Doctor successfully searched diagnoses and viewed templates,pass
PT-011,Doctor View Templates For Diagnosis,Doctor selects diagnosis and views available templates,Doctor logged in; diagnosis exists; templates present,Template list displays templates with step counts and preview; select available,,
PT-012,Doctor Assign Template To Patient,Doctor assigns a chosen template to a patient creating a PatientTreatmentPlan,Doctor logged in; patient exists; template exists,PatientTreatmentPlan created; planId returned; plan status active; toast "Plan Assigned",test_PT012: Doctor successfully assigned template to patient,pass
PT-013,Doctor Assign Template Mapping Steps,Verify each template step maps to TreatmentPlanAppointment records with pending status,Doctor assigns template to patient,For each template step a TreatmentPlanAppointment created with status pending priority set; order preserved,,
PT-014,Doctor Assign Template Concurrency,Two doctors attempt to assign same template to same patient concurrently,Both sessions active; same template selected,System handles concurrency; either one succeeds and other receives confirmation or duplicate prevention message; no inconsistent duplicates,,
PT-015,Doctor Assign Template With Missing Step Data,Assign template that has a step missing appointment_type and verify handling,Doctor assigns template with incomplete step,Operation fails with validation error; admin notified to fix template or system uses fallback appointment_type,,
PT-016,Patient View Assigned Treatment Plan,Patient opens treatment plan page and sees roadmap and step statuses,Patient logged in; active plan assigned,Plan details render with steps ordered; statuses pending booked done; attachments and instructions visible,test_PT016: Patient successfully viewed assigned treatment plan,pass
PT-017,Patient Book Step From Plan,Patient clicks Book Now on a pending step and is redirected to prefilled booking form,Patient logged in; step status pending; available slots exist,Redirect to booking form with appointment_type prefilled; booking flow completes; step status updates to booked,test_PT017: Patient successfully booked step from treatment plan,pass
PT-018,Patient Book Step Already Booked,Patient attempts to book a step that was just booked by another session,Patient logged in; race condition simulated,Booking fails with 409 Conflict; user shown "Step already booked" and link back to plan,,
PT-019,Patient Book Step Unauthorized,Patient tries to book a plan step that belongs to another patient,Patient logged in; planAppointmentId not owned by user,Authorization denied; 401 or 403 returned; no booking created,,
PT-020,Patient Cancel Booked Step,Patient cancels a booked step and verify status reverts to pending per policy,Patient has booked step and cancellation allowed,Appointment cancelled; TreatmentPlanAppointment status set to pending or cancelled per policy; notifications sent,,
PT-021,Patient Pre-filled Booking Fields,Verify booking form pre-fills appointment_type and planAppt id from plan step,Patient clicks Book Now,Booking form shows appointment_type and planAppt query param; submission links appointment to plan step,,
PT-022,Patient View Plan Timeline Updates After Booking,After booking a step verify timeline updates to show booked status without full page reload,Patient books step; timeline open,Timeline updates via refresh or live update; step shows status booked and timestamp,,
PT-023,Doctor Override Step Status,Doctor marks a step as completed manually and verify plan updates,Doctor finalizes step after visit,Step status set to done; appointmentId linked; plan progress updated; audit log entry created,,
PT-024,Doctor Reschedule Plan Step,Doctor reschedules a plan step appointment and verify patient notified,Doctor edits appointment linked to plan step,Appointment updated; TreatmentPlanAppointment status remains booked; patient receives notification of reschedule,,
PT-025,Admin Archive Diagnosis,Admin archives a diagnosis and verify templates become inactive for new assignments,Admin logged in; diagnosis selected,Diagnosis archived; templates flagged inactive; existing patient plans remain unaffected,,
PT-026,Admin Template Versioning,Admin edits a template and verifies version history and that existing assigned plans are unaffected,Admin updates template steps,New template version created; existing PatientTreatmentPlans retain original step definitions; new assignments use updated template,,
PT-027,Validation For Suggested Time Gaps,Ensure suggested_time_gap values are validated positive integers and enforced,Admin creates or edits step with invalid gap,Request rejected with validation error; clear message shown,,
PT-028,Notifications On Plan Assignment,Verify patient receives notification email when a plan is assigned,Plan assigned by doctor,Notification queued and sent; patient receives email with plan summary and link,,
PT-029,Plan Assignment Audit Trail,Confirm audit log records doctor admin patient template and timestamp on assignment,Template assigned,Audit log contains entry with user id role action planId templateId timestamp,,
PT-030,Plan Deletion Safety,Admin attempts to delete a template that was used historically and verify soft delete or archival behavior,Admin logged in; template used in past,Operation archives template; historical patient plans remain intact; deletion prevented or soft deleted,,
PT-031,Edge Case Empty Template Steps,Admin creates template with zero steps and doctor assigns it verify behavior,Admin creates empty template; doctor assigns to patient,Assignment either blocked with validation error or creates empty plan with clear UI warning; system behavior consistent with spec,,
PT-032,Data Consistency After DB Failure,Simulate DB failure during plan assignment and verify rollback and user feedback,DB failure simulated during insert,Transaction rolled back; no partial plan created; user shown error and retry option; no orphaned steps,,
PT-033,Permission Matrix Enforcement,Verify only admins can manage diagnoses only doctors can assign plans and only patients can book their plan steps,Users with different roles attempt restricted actions,Unauthorized attempts return 403; authorized actions succeed,,
PT-034,Export Assigned Plan,Doctor or patient requests export of treatment plan and verify exported content matches plan,User requests export; export feature enabled,Export contains plan metadata steps statuses appointment links and timestamps matching UI,,
PT-035,Localization Of Templates,Verify templates and step labels render correctly in Sinhala and English per user preference,User language preference set to Sinhala or English,Template titles and step labels localized; UI shows correct translations,,